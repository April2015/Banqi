angular.module("myApp",[]).factory("gameLogic",function(){"use strict";function a(){return[{setTurn:{turnIndex:0}},{set:{key:"delta",value:{rowBeforeMove:-1,colBeforeMove:-1,rowAfterMove:-1,colAfterMove:-1}}},{set:{key:"b0x0",value:"R1"}},{set:{key:"b0x1",value:"R1"}},{set:{key:"b0x2",value:"R1"}},{set:{key:"b0x3",value:"R1"}},{set:{key:"b0x4",value:"R1"}},{set:{key:"b0x5",value:"R2"}},{set:{key:"b0x6",value:"R2"}},{set:{key:"b0x7",value:"R3"}},{set:{key:"b1x0",value:"R3"}},{set:{key:"b1x1",value:"R4"}},{set:{key:"b1x2",value:"R4"}},{set:{key:"b1x3",value:"R5"}},{set:{key:"b1x4",value:"R5"}},{set:{key:"b1x5",value:"R6"}},{set:{key:"b1x6",value:"R6"}},{set:{key:"b1x7",value:"R7"}},{set:{key:"b2x0",value:"B1"}},{set:{key:"b2x1",value:"B1"}},{set:{key:"b2x2",value:"B1"}},{set:{key:"b2x3",value:"B1"}},{set:{key:"b2x4",value:"B1"}},{set:{key:"b2x5",value:"B2"}},{set:{key:"b2x6",value:"B2"}},{set:{key:"b2x7",value:"B3"}},{set:{key:"b3x0",value:"B3"}},{set:{key:"b3x1",value:"B4"}},{set:{key:"b3x2",value:"B4"}},{set:{key:"b3x3",value:"B5"}},{set:{key:"b3x4",value:"B5"}},{set:{key:"b3x5",value:"B6"}},{set:{key:"b3x6",value:"B6"}},{set:{key:"b3x7",value:"B7"}},{set:{key:"stage",value:0}},{shuffle:{keys:["b0x0","b0x1","b0x2","b0x3","b0x4","b0x5","b0x6","b0x7","b1x0","b1x1","b1x2","b1x3","b1x4","b1x5","b1x6","b1x7","b2x0","b2x1","b2x2","b2x3","b2x4","b2x5","b2x6","b2x7","b3x0","b3x1","b3x2","b3x3","b3x4","b3x5","b3x6","b3x7"]}},{setVisibility:{key:"b0x0",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b0x1",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b0x2",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b0x3",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b0x4",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b0x5",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b0x6",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b0x7",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b1x0",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b1x1",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b1x2",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b1x3",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b1x4",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b1x5",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b1x6",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b1x7",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b2x0",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b2x1",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b2x2",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b2x3",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b2x4",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b2x5",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b2x6",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b2x7",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b3x0",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b3x1",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b3x2",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b3x3",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b3x4",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b3x5",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b3x6",visibleToPlayerIndexes:[]}},{setVisibility:{key:"b3x7",visibleToPlayerIndexes:[]}}]}function b(a,b){return"b"+a.toString()+"x"+b.toString()}function c(a){for(var c=0,d=0,e=0;4>e;e++)for(var f=0;8>f;f++){if(null===a[b(e,f)])return"";"R"===a[b(e,f)][0]&&c++,"B"===a[b(e,f)][0]&&d++}return 0===c?"B":0===d?"R":""}function d(a){for(var c=0,d=0,f=0,g=0,h=0,i=0,j=0;4>j;j++)for(var k=0;8>k;k++){if(null===a[b(j,k)])return!1;"R"===a[b(j,k)][0]&&(c++,f=j,g=k),"B"===a[b(j,k)][0]&&(d++,h=j,i=k)}if(1===c&&1===d&&!e(f,g,h,i))return!0;if(1===c&&d>1){for(var j=0;4>j;j++)for(var k=0;8>k;k++)if("B"===a[b(j,k)][0]&&a[b(f,g)][1]<a[b(j,k)][1])return!1;return!0}if(1===d&&c>1){for(var j=0;4>j;j++)for(var k=0;8>k;k++)if("R"===a[b(j,k)][0]&&a[b(h,i)][1]<a[b(j,k)][1])return!1;return!0}return!1}function e(a,b,c,d){return(a!==c||b-d!==1&&b-d!==-1)&&(b!==d||a-c!==1&&a-c!==-1)?!1:!0}function f(a,b){var c,d,e,f,h=[];for(c=0;4>c;c++)for(d=0;8>d;d++)for(e=-1;4>e;e++)for(f=-1;8>f;f++)try{h.push(g(a,c,d,e,f,b))}catch(i){}return h}function g(a,c,d,e,f,g){if(""===a[b(c,d)])throw new Error("There is nothing at that position!");if(null===a[b(c,d)]&&(-1!==e||-1!==f))throw new Error("Can not move a unturned piece!");if(null!==a[b(c,d)]&&-1===e&&-1===f)throw new Error("This piece is already turned!");if(null!==a[b(c,d)]){if(a[b(c,d)][0]===a[b(e,f)][0])throw new Error("You can't kill yourself!");if("R"===a[b(c,d)][0]&&0!==g)throw new Error("Please wait for your turn!");if("B"===a[b(c,d)][0]&&1!==g)throw new Error("Please wait for your turn!")}if(c===e&&d===f)throw new Error("Same piece, move canceled!");var h;return h=null===a[b(c,d)]&&-1===e&&-1===f?[{setVisibility:{key:b(c,d),visibleToPlayerIndexes:null}}]:""===a[b(e,f)]?i(a,c,d,e,f):j(a,c,d,e,f),[{setTurn:{turnIndex:g}},{set:{key:"delta",value:{rowBeforeMove:c,colBeforeMove:d,rowAfterMove:e,colAfterMove:f}}},{set:{key:"stage",value:1}}].concat(h)}function h(a,b){var e,f=c(a);return e=""!==f||d(a)?{endMatch:{endMatchScores:"R"===f?[1,0]:"B"===f?[0,1]:[0,0]}}:{setTurn:{turnIndex:1-b}},[e,{set:{key:"stage",value:0}}]}function i(a,c,d,f,g){if(e(c,d,f,g))return[{set:{key:b(f,g),value:a[b(c,d)]}},{set:{key:b(c,d),value:""}}];throw new Error("You can not move the piece to that position!")}function j(a,c,d,e,f){if(null===a[b(e,f)])throw new Error("You can not kill a unturned piece!");if("2"===a[b(c,d)][1]){if(c===e){var g,h,j=0;d>f?(g=d,h=f):(g=f,h=d);for(var k=h+1;g>k;k++)""!==a[b(e,k)]&&j++;if(1===j)return[{set:{key:b(e,f),value:a[b(c,d)]}},{set:{key:b(c,d),value:""}}]}if(d===f){var g,h,j=0;c>e?(g=c,h=e):(g=e,h=c);for(var k=h+1;g>k;k++)""!==a[b(k,f)]&&j++;if(1===j)return[{set:{key:b(e,f),value:a[b(c,d)]}},{set:{key:b(c,d),value:""}}]}throw new Error("You can not kill the piece at that position!")}if("7"===a[b(c,d)][1]&&"1"===a[b(e,f)][1])throw new Error("General can not kills soldier, soldier kills General!");if("1"===a[b(c,d)][1]&&"7"===a[b(e,f)][1])return i(a,c,d,e,f);if(a[b(c,d)][1]>=a[b(e,f)][1])return i(a,c,d,e,f);throw new Error("You can not kill the piece at that position!")}function k(b){var c=b.move,d=b.turnIndexBeforeMove,e=b.stateBeforeMove;try{var f;if(null!==e&&(f=e.stage),console.log("stage",f),0===f){var i=c[1].set.value,j=i.rowBeforeMove,k=i.colBeforeMove,l=i.rowAfterMove,m=i.colAfterMove,n=g(e,j,k,l,m,d);if(!angular.equals(c,n))return console.log("move, expectedMove are not equal"),!1}else if(1===f){var n=h(e,d);if(!angular.equals(c,n))return console.log("move, expectedMove are not equal"),!1}else{console.log("should initialGame");var n=a();if(!angular.equals(c,n))return console.log("move: ",c),console.log("expectedMove: ",n),console.log("move, expectedMove are not equal"),!1}}catch(o){return console.log("got exceptions in isMoveOk: ",o),!1}return console.log("isMoveOk is True!"),!0}return{initialGame:a,getPossibleMoves:f,createMove:g,checkGameEnd:h,isMoveOk:k}}),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","gameService","stateService","gameLogic","resizeGameAreaService",function(a,b,c,d,e,f,g){"use strict";function h(){var b=f.getPossibleMoves(a.stateAfterMove,a.turnIndex);console.log("possibleMoves: ",b),d.makeMove(b[Math.floor(Math.random()*b.length)]),d.makeMove(f.checkGameEnd(a.stateAfterMove,a.turnIndex))}function i(b){a.stateAfterMove=b.stateAfterMove,a.delta=b.stateAfterMove.delta,a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.turnIndex=b.turnIndexAfterMove,1!==l&&a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId?(l=1,c(h,500)):l=0}function j(a,b){return"b"+a.toString()+"x"+b.toString()}function k(){try{var a=f.initialGame();d.makeMove(a)}catch(c){return b.info(c),void b.info("initialGame() failed")}}g.setWidthToHeight(2);var l=0;window.e2e_test_stateService=e,d.setGame({gameDeveloperEmail:"xiaodongbo627@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:f.isMoveOk,updateUI:i}),k();var m=null,n=null,o=null;a.cellClicked=function(c,e){if(b.info(["Clicked on cell:",c,e]),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(a.isYourTurn){if(null!==a.stateAfterMove[j(c,e)]||null!==m&&null!==n){if(null===m||null===n)return m=c,n=e,void(a.shouldShowImage(m,n)&&(o=document.getElementById("img_"+m+"x"+n),o.className="pieceClicked"));try{var g=f.createMove(a.stateAfterMove,m,n,c,e,a.turnIndex);a.isYourTurn=!1,d.makeMove(g),null!==o&&(o.className="piece",o=null)}catch(h){return b.info(["Can not move the piece:",m,n,c,e]),m=null,n=null,void(null!==o&&(o.className="piece",o=null))}}else try{var g=f.createMove(a.stateAfterMove,c,e,-1,-1,a.turnIndex);a.isYourTurn=!1,d.makeMove(g)}catch(h){return void b.info(["Cell is already full in position:",c,e,-1,-1])}try{var g=f.checkGameEnd(a.stateAfterMove,a.turnIndex);a.isYourTurn=!1,d.makeMove(g),m=null,n=null,null!==o&&(o.className="piece",o=null)}catch(h){return b.info(h),b.info("checkGameEnd failed!"),m=null,n=null,void(null!==o&&(o.className="piece",o=null))}}},a.shouldShowImage=function(b,c){var d=a.stateAfterMove[j(b,c)];return""!==d},a.getImageSrc=function(b,c){var d=a.stateAfterMove[j(b,c)];return"R1"===d?"res/R1.png":"R2"===d?"res/R2.png":"R3"===d?"res/R3.png":"R4"===d?"res/R4.png":"R5"===d?"res/R5.png":"R6"===d?"res/R6.png":"R7"===d?"res/R7.png":"B1"===d?"res/B1.png":"B2"===d?"res/B2.png":"B3"===d?"res/B3.png":"B4"===d?"res/B4.png":"B5"===d?"res/B5.png":"B6"===d?"res/B6.png":"B7"===d?"res/B7.png":null===d?"res/Hide.png":""}}]);
//# sourceMappingURL=everything.min.js.map